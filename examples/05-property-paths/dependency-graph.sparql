# Граф зависимостей (до 3 уровней)
#
# Построить полный граф зависимостей с явным указанием глубины.
#
# Ожидаемый результат: 15 связей (уровни 1, 2, 3)
# Время выполнения: < 1 секунды

PREFIX : <http://example.org/adr#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?from ?to ?depth
WHERE {
    {
        ?fromTech :dependsOn ?toTech .           # Уровень 1: прямая зависимость
        BIND(1 AS ?depth)                        # Глубина = 1
    }
    UNION
    {
        ?fromTech :dependsOn/:dependsOn ?toTech . # Уровень 2: цепочка из 2 шагов
        BIND(2 AS ?depth)                         # Глубина = 2
    }
    UNION
    {
        ?fromTech :dependsOn/:dependsOn/:dependsOn ?toTech . # Уровень 3: цепочка из 3 шагов
        BIND(3 AS ?depth)                                     # Глубина = 3
    }
    
    ?fromTech rdfs:label ?from .                 # Название технологии-источника
    ?toTech rdfs:label ?to .                     # Название технологии-назначения
}
ORDER BY ?from ?depth                            # Сортировать по источнику и глубине

# Пояснение:
# Property Path / означает "следовать по связи" (аналог JOIN в SQL).
# :dependsOn/:dependsOn - два последовательных шага по :dependsOn.
# :dependsOn/:dependsOn/:dependsOn - три последовательных шага.
# UNION объединяет все три уровня в один результат.
# Полезно для визуализации и понимания сложных архитектурных зависимостей.
# В SQL: рекурсивные CTE с ограничением глубины.
# В Property Graph: обход в ширину с контролем глубины.
