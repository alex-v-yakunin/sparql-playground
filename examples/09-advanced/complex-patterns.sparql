# Сложные SPARQL-паттерны
#
# Демонстрация продвинутых возможностей: BIND, VALUES, MINUS, EXISTS.
#
# Ожидаемый результат: ADR с заданными статусами, имеющие системный контекст, без Redis
# Время выполнения: < 1 секунды

PREFIX : <http://example.org/adr#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?adr ?label ?technology ?confidence ?hasEvidence
WHERE {
    VALUES ?targetStatus { :Accepted :Proposed }  # Ограничить статусы списком
    
    ?adr a :ADR ;                      # Найти все ADR
         rdfs:label ?label ;           # Получить название
         :hasStatus ?targetStatus ;    # Фильтр: только указанные статусы
         :decidesTechnology ?tech ;    # Получить технологию
         :hasConfidence ?confidence .  # Получить уверенность
    
    ?tech rdfs:label ?technology .     # Название технологии
    
    FILTER EXISTS {                    # Проверить наличие системного контекста
        ?adr :appliesTo ?system .      # ADR должен быть привязан к системе
    }
    
    MINUS {                            # Исключить Redis
        ?adr :decidesTechnology :Redis . # Убрать ADR о Redis
    }
    
    BIND(                              # Вычислить наличие доказательств
        EXISTS {
            ?statement a <http://www.w3.org/1999/02/22-rdf-syntax-ns#Statement> ;
                       <http://www.w3.org/1999/02/22-rdf-syntax-ns#subject> ?adr ;
                       :evidenceSource ?source .
        }
        AS ?hasEvidence                # Присвоить результат переменной
    )
}
ORDER BY DESC(?confidence)             # Сортировать по уверенности (убывание)

# Пояснение:
# Демонстрирует четыре продвинутых возможности SPARQL:
# 
# 1. VALUES - задаёт список допустимых значений (IN в SQL)
#    VALUES ?targetStatus { :Accepted :Proposed }
# 
# 2. FILTER EXISTS - проверяет наличие паттерна
#    Оставляет только ADR с системным контекстом
# 
# 3. MINUS - исключает результаты, соответствующие паттерну
#    Убирает все ADR о Redis из результатов
# 
# 4. BIND с EXISTS - создаёт вычисляемую переменную
#    Проверяет наличие доказательств для каждого ADR
# 
# В SQL: комбинация WHERE IN, EXISTS, NOT IN и подзапросов.
# В Property Graph: фильтры на узлах и рёбрах.
# В SPARQL: декларативный и выразительный синтаксис!
