# Complex SPARQL Patterns
#
# Demonstration of advanced features: BIND, VALUES, MINUS, EXISTS.
#
# Expected result: ADRs with specified statuses, having system context, without Redis
# Execution time: < 1 second

PREFIX : <http://example.org/adr#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?adr ?label ?technology ?confidence ?hasEvidence
WHERE {
    VALUES ?targetStatus { :Accepted :Proposed }  # Limit statuses to list
    
    ?adr a :ADR ;                      # Find all ADRs
         rdfs:label ?label ;           # Get label
         :hasStatus ?targetStatus ;    # Filter: only specified statuses
         :decidesTechnology ?tech ;    # Get technology
         :hasConfidence ?confidence .  # Get confidence
    
    ?tech rdfs:label ?technology .     # Technology label
    
    FILTER EXISTS {                    # Check presence of system context
        ?adr :appliesTo ?system .      # ADR must be bound to system
    }
    
    MINUS {                            # Exclude Redis
        ?adr :decidesTechnology :Redis . # Remove ADRs about Redis
    }
    
    BIND(                              # Calculate evidence presence
        EXISTS {
            ?statement a <http://www.w3.org/1999/02/22-rdf-syntax-ns#Statement> ;
                       <http://www.w3.org/1999/02/22-rdf-syntax-ns#subject> ?adr ;
                       :evidenceSource ?source .
        }
        AS ?hasEvidence                # Assign result to variable
    )
}
ORDER BY DESC(?confidence)             # Sort by confidence (descending)

# Explanation:
# Demonstrates four advanced SPARQL features:
# 
# 1. VALUES - specifies list of allowed values (IN in SQL)
#    VALUES ?targetStatus { :Accepted :Proposed }
# 
# 2. FILTER EXISTS - checks pattern presence
#    Keeps only ADRs with system context
# 
# 3. MINUS - excludes results matching pattern
#    Removes all ADRs about Redis from results
# 
# 4. BIND with EXISTS - creates computed variable
#    Checks evidence presence for each ADR
# 
# In SQL: combination of WHERE IN, EXISTS, NOT IN and subqueries.
# In Property Graph: filters on nodes and edges.
# In SPARQL: declarative and expressive syntax!
