# След доказательств для решений
#
# Отследить источники доказательств для архитектурных решений.
#
# Ожидаемый результат: 7 ADR с источниками доказательств (или без них)
# Время выполнения: < 1 секунды

PREFIX : <http://example.org/adr#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>

SELECT ?adrLabel ?technology ?evidenceSource ?confidence
WHERE {
    ?statement a rdf:Statement ;       # Найти реифицированное утверждение
               rdf:subject ?adr ;      # О каком ADR
               rdf:predicate :decidesTechnology ; # Предикат: выбор технологии
               rdf:object ?tech ;      # Какая технология
               :confidence ?confidence . # Уровень уверенности
    
    OPTIONAL {                         # Источник может отсутствовать
        ?statement :evidenceSource ?evidenceSource . # Источник доказательства
    }
    
    ?adr rdfs:label ?adrLabel .        # Название ADR
    ?tech rdfs:label ?technology .     # Название технологии
}
ORDER BY ?adrLabel                     # Сортировать по названию ADR

# Пояснение:
# Reification позволяет хранить метаданные о решениях: уверенность, источники.
# OPTIONAL означает, что ?evidenceSource может отсутствовать (будет NULL/unbound).
# Критично для compliance: откуда мы знаем, что это правильное решение?
# В SQL: таблица decisions_evidence с LEFT JOIN.
# В Property Graph: свойства на рёбрах или мета-узлы.
# В RDF: естественное моделирование через reification.

# Дополнительный запрос: найти решения БЕЗ доказательств
# Раскомментируйте следующий запрос:

# SELECT ?adrLabel ?technology ?confidence
# WHERE {
#     ?statement a rdf:Statement ;       # Найти реифицированное утверждение
#                rdf:subject ?adr ;      # О каком ADR
#                rdf:predicate :decidesTechnology ; # Предикат: выбор технологии
#                rdf:object ?tech ;      # Какая технология
#                :confidence ?confidence . # Уровень уверенности
#     
#     FILTER NOT EXISTS {                # Проверить отсутствие
#         ?statement :evidenceSource ?source . # Источника доказательства
#     }
#     
#     ?adr rdfs:label ?adrLabel .        # Название ADR
#     ?tech rdfs:label ?technology .     # Название технологии
# }
# ORDER BY ?confidence                   # Сортировать по уверенности
