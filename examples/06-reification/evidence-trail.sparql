# Evidence Trail for Decisions
#
# Track evidence sources for architectural decisions.
#
# Expected result: 7 ADRs with evidence sources (or without them)
# Execution time: < 1 second

PREFIX : <http://example.org/adr#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>

SELECT ?adrLabel ?technology ?evidenceSource ?confidence
WHERE {
    ?statement a rdf:Statement ;       # Find reified statement
               rdf:subject ?adr ;      # About which ADR
               rdf:predicate :decidesTechnology ; # Predicate: technology choice
               rdf:object ?tech ;      # Which technology
               :confidence ?confidence . # Confidence level
    
    OPTIONAL {                         # Source may be absent
        ?statement :evidenceSource ?evidenceSource . # Evidence source
    }
    
    ?adr rdfs:label ?adrLabel .        # ADR label
    ?tech rdfs:label ?technology .     # Technology label
}
ORDER BY ?adrLabel                     # Sort by ADR label

# Explanation:
# Reification allows storing metadata about decisions: confidence, sources.
# OPTIONAL means ?evidenceSource may be absent (will be NULL/unbound).
# Critical for compliance: how do we know this is the right decision?
# In SQL: decisions_evidence table with LEFT JOIN.
# In Property Graph: properties on edges or meta-nodes.
# In RDF: natural modeling through reification.

# Additional query: find decisions WITHOUT evidence
# Uncomment the following query:

# SELECT ?adrLabel ?technology ?confidence
# WHERE {
#     ?statement a rdf:Statement ;       # Find reified statement
#                rdf:subject ?adr ;      # About which ADR
#                rdf:predicate :decidesTechnology ; # Predicate: technology choice
#                rdf:object ?tech ;      # Which technology
#                :confidence ?confidence . # Confidence level
#     
#     FILTER NOT EXISTS {                # Check absence
#         ?statement :evidenceSource ?source . # Of evidence source
#     }
#     
#     ?adr rdfs:label ?adrLabel .        # ADR label
#     ?tech rdfs:label ?technology .     # Technology label
# }
# ORDER BY ?confidence                   # Sort by confidence
