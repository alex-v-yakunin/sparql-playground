# История отклонённых решений
#
# Отследить историю изменений статуса ADR (аудит).
#
# Ожидаемый результат: 1 запись (ADR-004 был Accepted → Deprecated)
# Время выполнения: < 1 секунды

PREFIX : <http://example.org/adr#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>

SELECT ?adrLabel ?oldStatus ?newStatus ?changedBy ?changedOn ?reason
WHERE {
    ?statement a rdf:Statement ;       # Найти реифицированное утверждение
               rdf:subject ?adr ;      # Субъект: о каком ADR утверждение
               rdf:predicate :hasStatus ; # Предикат: свойство :hasStatus
               rdf:object ?newStatus ;    # Объект: новый статус
               :previousValue ?oldStatus ; # Предыдущее значение статуса
               :statedBy ?person ;         # Кто изменил
               :statedOn ?changedOn ;      # Когда изменил
               :changeReason ?reason .     # Причина изменения
    
    ?adr rdfs:label ?adrLabel .        # Название ADR
    ?person rdfs:label ?changedBy .    # Имя человека
}
ORDER BY ?changedOn                    # Сортировать по дате изменения

# Пояснение:
# Reification позволяет делать утверждения об утверждениях.
# Структура: rdf:subject, rdf:predicate, rdf:object описывают исходный триплет.
# Дополнительные свойства (:previousValue, :statedBy, :statedOn, :changeReason)
# добавляют метаданные к изменению.
# Критично для аудита и комплаенса: кто, когда и почему изменил статус.
# В SQL: таблица audit_log с триггерами.
# В Property Graph: мета-рёбра или гипергрифы.
# В RDF: встроенная поддержка через reification.
