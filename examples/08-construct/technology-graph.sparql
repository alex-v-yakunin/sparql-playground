# Граф технологий с метаданными (CONSTRUCT)
#
# Построить граф технологий с зависимостями и метаданными для визуализации.
#
# Ожидаемый результат: Граф с 7 технологиями, их зависимостями и свойствами
# Время выполнения: < 1 секунды

PREFIX : <http://example.org/adr#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

CONSTRUCT {
    ?tech rdfs:label ?label ;          # Название технологии
          :usedBy ?adr ;               # Какие ADR используют эту технологию
          :dependsOn ?dep ;            # Прямые зависимости
          :dependsOnIndirectly ?indirectDep .  # Косвенные зависимости (глубина 2)
}
WHERE {
    ?tech a :Technology ;              # Найти все технологии
          rdfs:label ?label .          # Получить название
    
    OPTIONAL {                         # ADR может не быть
        ?adr :decidesTechnology ?tech . # Найти ADR, использующие технологию
    }
    
    OPTIONAL {                         # Зависимости могут отсутствовать
        ?tech :dependsOn ?dep .        # Прямые зависимости
    }
    
    OPTIONAL {                         # Косвенные зависимости
        ?tech :dependsOn/:dependsOn ?indirectDep .  # Глубина 2
    }
}

# Пояснение:
# CONSTRUCT создаёт богатый граф для инструментов визуализации.
# Включаем несколько типов связей:
# - :usedBy - связь с ADR
# - :dependsOn - прямые зависимости
# - :dependsOnIndirectly - косвенные зависимости (глубина 2)
# 
# OPTIONAL гарантирует включение всех технологий, даже без связей.
# Property Path :dependsOn/:dependsOn находит зависимости глубины 2.
# 
# Результат можно визуализировать в инструментах типа:
# - Graphviz, Cytoscape, Gephi
# - D3.js, vis.js для веб-визуализации
# 
# В SQL: множественные LEFT JOIN для создания денормализованной таблицы.
# В Property Graph: projection с фильтрацией типов рёбер.
# В SPARQL: CONSTRUCT естественно создаёт новые графы!
